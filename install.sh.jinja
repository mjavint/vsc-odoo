#!/bin/bash
set -e
ODOO_SOURCE="OCA/OCB"
ODOO_VERSION="{{odoo_version}}"

echo "ğŸš€ Starting Odoo dependencies setup with uv..."

echo "ğŸ“¥ Downloading requirements.txt from $ODOO_SOURCE/$ODOO_VERSION..."
curl -o requirements.txt "https://raw.githubusercontent.com/$ODOO_SOURCE/$ODOO_VERSION/requirements.txt" \
    && sed -i -E "s/(gevent==)21\.8\.0( ; sys_platform != 'win32' and python_version == '3.10')/\122.10.2\2/;s/(greenlet==)1.1.2( ; sys_platform != 'win32' and python_version == '3.10')/\12.0.2\2/" requirements.txt

echo "ğŸ“¥ Creating virtual environment..." \
uv venv \
    && echo "ğŸ” Activating virtual environment and syncing dependencies..." \
    && source .venv/bin/activate \
    && uv sync \

echo "ğŸ“¥ Installing Python dependencies from requirements.txt..." \
    && uv pip install --no-cache-dir -r requirements.txt \

echo "ğŸ§¹ Cleaning up temporary requirements.txt file..." \
rm requirements.txt \
    && echo "âœ… All dependencies installed successfully! Environment ready. ğŸ‰" \
    && echo "ğŸ’¡ Activate your environment anytime with: source .venv/bin/activate"
